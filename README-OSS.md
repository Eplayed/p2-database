# PoE2 Ladder æ•°æ®è·å–ä¸OSSä¸Šä¼ æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬é¡¹ç›®åŒ…å«ä»¥ä¸‹åŠŸèƒ½ï¼š
1. è‡ªåŠ¨è·å–PoE2å„èŒä¸šæ¢¯å­æ•°æ®
2. ç”Ÿæˆåˆå¹¶çš„all_ladders.jsonæ–‡ä»¶
3. ä¸Šä¼ æ•°æ®åˆ°é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨OSS
4. ç”Ÿæˆä¸Šä¼ æ—¥å¿—å’Œç»Ÿè®¡ä¿¡æ¯

## ğŸ› ï¸ ä½¿ç”¨æ­¥éª¤

### 1. å®‰è£…ä¾èµ–

```bash
npm install puppeteer
npm install ali-oss  # OSSä¸Šä¼ æ—¶éœ€è¦
```

### 2. é…ç½®é˜¿é‡Œäº‘OSSå‡­è¯

ç¼–è¾‘ `oss-config.json` æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„é˜¿é‡Œäº‘OSSå‡­è¯ï¼š

```json
{
  "region": "oss-cn-hangzhou",           // OSSåŒºåŸŸ
  "bucket": "your-bucket-name",          // OSSå­˜å‚¨æ¡¶åç§°
  "accessKeyId": "YOUR_ACCESS_KEY_ID",   // ä½ çš„AccessKey ID
  "accessKeySecret": "YOUR_ACCESS_KEY_SECRET", // ä½ çš„AccessKey Secret
  "endpoint": "https://oss-cn-hangzhou.aliyuncs.com",
  "folder": "poe2-ladders"               // OSSä¸­çš„æ–‡ä»¶å¤¹è·¯å¾„
}
```

**è·å–OSSå‡­è¯çš„æ–¹æ³•ï¼š**
1. ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°
2. è®¿é—®"è®¿é—®æ§åˆ¶ RAM" > "ç”¨æˆ·"
3. åˆ›å»ºç”¨æˆ·å¹¶æˆæƒOSSæƒé™
4. è·å–AccessKey IDå’ŒSecret

### 3. æ‰§è¡Œæ•°æ®è·å–

#### æ–¹å¼ä¸€ï¼šè·å–æ‰€æœ‰èŒä¸šæ¢¯å­æ•°æ®ï¼ˆæ¨èï¼‰

```bash
node get_all_ladders.js
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
- è¯»å–ç°æœ‰çš„èŒä¸šåˆ—è¡¨ï¼ˆladder/data/classes.jsonï¼‰
- è·å–æ¯ä¸ªèŒä¸šçš„æ¢¯å­æ•°æ®ï¼ˆå‰100åç©å®¶ï¼‰
- ç”Ÿæˆ `all_ladders.json` åˆå¹¶æ–‡ä»¶
- æ›´æ–°å„èŒä¸šçš„å•ç‹¬æ•°æ®æ–‡ä»¶

#### æ–¹å¼äºŒï¼šä»…è·å–èŒä¸šåˆ—è¡¨

```bash
node auto_browser/index.js
```

### 4. ä¸Šä¼ åˆ°é˜¿é‡Œäº‘OSS

```bash
node upload_to_oss.js
```

ä¸Šä¼ å†…å®¹åŒ…æ‹¬ï¼š
- `all_ladders.json` - å®Œæ•´çš„æ¢¯å­æ•°æ®
- `ladder/data/classes.json` - èŒä¸šåˆ—è¡¨
- `ladder/data/*.json` - å„èŒä¸šå•ç‹¬çš„æ•°æ®æ–‡ä»¶

## ğŸ“ ç”Ÿæˆçš„æ–‡ä»¶

### æ•°æ®æ–‡ä»¶
- `all_ladders.json` - åŒ…å«æ‰€æœ‰èŒä¸šæ¢¯å­æ•°æ®çš„åˆå¹¶æ–‡ä»¶
- `ladder/data/classes.json` - èŒä¸šç»Ÿè®¡ä¿¡æ¯
- `ladder/data/{ClassName}.json` - å„èŒä¸šçš„è¯¦ç»†æ¢¯å­æ•°æ®

### ä¸Šä¼ æ—¥å¿—
- `upload_log_YYYY-MM-DD.json` - ä¸Šä¼ æ“ä½œæ—¥å¿—

## ğŸ“Š all_ladders.json ç»“æ„è¯´æ˜

```json
{
  "updateTime": "2023-12-16T10:30:00.000Z",
  "totalClasses": 10,
  "totalPlayers": 1000,
  "classes": [
    {
      "name": "Shaman",
      "percent": "19.7%",
      "icon": "https://poe.ninja/poe2-assets/cdn/classes/shaman.webp",
      "playerCount": 100
    }
  ],
  "ladders": {
    "Shaman": [
      {
        "rank": 1,
        "name": "PlayerName",
        "level": 96,
        "class": "Shaman",
        "account": "AccountName-1234",
        "linkUrl": "https://poe.ninja/poe2/builds/vaal/character/AccountName-1234/PlayerName"
      }
    ]
  }
}
```

## ğŸ”§ é…ç½®é€‰é¡¹

### OSSé…ç½®é€‰é¡¹
- `region`: OSSåŒºåŸŸï¼ˆå¦‚ï¼šoss-cn-hangzhouï¼‰
- `bucket`: å­˜å‚¨æ¡¶åç§°
- `folder`: OSSä¸­çš„æ–‡ä»¶å¤¹è·¯å¾„
- `endpoint`: OSSè®¿é—®åŸŸå

### è·å–æ•°æ®é…ç½®
åœ¨ `get_all_ladders.js` ä¸­å¯ä»¥è°ƒæ•´ï¼š
- `await page.waitForTimeout(1000)` - è¯·æ±‚é—´éš”æ—¶é—´
- è¡¨æ ¼é€‰æ‹©å™¨ - é€‚åº”ç½‘ç«™ç»“æ„å˜åŒ–

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **é¦–æ¬¡ä½¿ç”¨å‰**ï¼š
   - ç¡®ä¿OSSå­˜å‚¨æ¡¶å·²åˆ›å»º
   - ç¡®ä¿è´¦æˆ·æœ‰OSSå†™å…¥æƒé™
   - å»ºè®®å…ˆæµ‹è¯•å°æ–‡ä»¶ä¸Šä¼ 

2. **é¢‘ç‡é™åˆ¶**ï¼š
   - è„šæœ¬åŒ…å«1ç§’è¯·æ±‚é—´éš”ï¼Œé¿å…å¯¹ç›®æ ‡ç½‘ç«™é€ æˆå‹åŠ›
   - å¯æ ¹æ®éœ€è¦è°ƒæ•´é—´éš”æ—¶é—´

3. **æ•°æ®æ›´æ–°**ï¼š
   - è„šæœ¬ä¼šä¼˜å…ˆä½¿ç”¨ç°æœ‰æ•°æ®ï¼Œå‡å°‘ç½‘ç»œè¯·æ±‚
   - å¦‚éœ€å¼ºåˆ¶æ›´æ–°ï¼Œå¯åˆ é™¤ `ladder/data/` ä¸­çš„JSONæ–‡ä»¶

4. **é”™è¯¯å¤„ç†**ï¼š
   - ç½‘ç»œé”™è¯¯ä¼šæˆªå›¾ä¿å­˜ä¸º `debug_*.png`
   - ä¸Šä¼ å¤±è´¥ä¼šç”Ÿæˆè¯¦ç»†æ—¥å¿—

## ğŸš€ å¿«é€Ÿå¼€å§‹

```bash
# 1. é…ç½®OSSå‡­è¯
vim oss-config.json

# 2. è·å–æ¢¯å­æ•°æ®
node get_all_ladders.js

# 3. ä¸Šä¼ åˆ°OSS
node upload_to_oss.js
```

## ğŸ“ˆ æ•°æ®ä½¿ç”¨å»ºè®®

1. **ç¼“å­˜ç­–ç•¥**ï¼šå‰ç«¯å¯ç¼“å­˜all_ladders.jsonï¼Œå®šæœŸæ›´æ–°
2. **åˆ†é¡µåŠ è½½**ï¼šå¤§æ–‡ä»¶å»ºè®®åˆ†é¡µæˆ–æŒ‰éœ€åŠ è½½å•ä¸ªèŒä¸šæ•°æ®
3. **CDNåŠ é€Ÿ**ï¼šå»ºè®®ä¸ºOSSé…ç½®CDNåŠ é€Ÿè®¿é—®
4. **ç‰ˆæœ¬ç®¡ç†**ï¼šOSSæ–‡ä»¶ååŒ…å«æ—¶é—´æˆ³ï¼Œä¾¿äºç‰ˆæœ¬å›æ»š

## ğŸ†˜ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **ä¸Šä¼ å¤±è´¥**ï¼šæ£€æŸ¥AccessKeyæ˜¯å¦æ­£ç¡®ï¼ŒBucketæ˜¯å¦å­˜åœ¨
2. **æ•°æ®è·å–å¤±è´¥**ï¼šæŸ¥çœ‹debug_*.pngæˆªå›¾ï¼Œæ£€æŸ¥ç½‘ç»œè¿æ¥
3. **æ–‡ä»¶æ ¼å¼é”™è¯¯**ï¼šç¡®ä¿JSONæ–‡ä»¶æ ¼å¼æ­£ç¡®ï¼Œæ— è¯­æ³•é”™è¯¯

### æ—¥å¿—æ–‡ä»¶
- `upload_log_*.json` - ä¸Šä¼ æ“ä½œè¯¦ç»†æ—¥å¿—
- `debug_*.png` - é”™è¯¯æ—¶çš„é¡µé¢æˆªå›¾